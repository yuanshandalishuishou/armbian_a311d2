# Khadas VIM4 Armbian ä¸€é”®æ„å»ºè„šæœ¬

![Armbian](https://img.shields.io/badge/Armbian-Debian%20Bookworm-orange)
![Khadas VIM4](https://img.shields.io/badge/Khadas-VIM4%20(A311D2)-green)
![License](https://img.shields.io/badge/License-MIT-blue)

ä¸€ä¸ªè‡ªåŠ¨åŒ–æ„å»º Khadas VIM4 å•æ¿è®¡ç®—æœº Armbian ç³»ç»Ÿçš„å®Œæ•´è§£å†³æ–¹æ¡ˆè„šæœ¬ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **å…¨è‡ªåŠ¨åŒ–æ„å»º** - ä»ç¯å¢ƒé…ç½®åˆ°é•œåƒç”Ÿæˆçš„å…¨æµç¨‹è‡ªåŠ¨åŒ–
- ğŸ–¥ï¸ **åŒç³»ç»Ÿæ”¯æŒ** - æ”¯æŒåŸºç¡€ç³»ç»Ÿå’Œ XFCE æ¡Œé¢ç³»ç»Ÿä¸¤ç§æ„å»ºæ¨¡å¼
- ğŸ”§ **ç¡¬ä»¶ä¼˜åŒ–** - é’ˆå¯¹ VIM4 ç¡¬ä»¶ç‰¹æ€§çš„ä¸“é—¨ä¼˜åŒ–é…ç½®
- ğŸŒ **å›½å†…ç½‘ç»œä¼˜åŒ–** - ä½¿ç”¨å›½å†…é•œåƒæºåŠ é€Ÿä¸‹è½½è¿‡ç¨‹
- ğŸ“¦ **å®Œæ•´é©±åŠ¨æ”¯æŒ** - åŒ…å« USB ç½‘å¡ã€æ— çº¿ç½‘ç»œã€è“ç‰™ç­‰ç¡¬ä»¶é©±åŠ¨
- ğŸ¯ **çµæ´»ç›®å½•é…ç½®** - æ”¯æŒè‡ªå®šä¹‰å·¥ä½œç›®å½•ï¼Œé€‚åº”ä¸åŒå­˜å‚¨éœ€æ±‚
- ğŸ“ **è¯¦ç»†æ—¥å¿—è¾“å‡º** - å½©è‰²æ—¥å¿—å’Œè¿›åº¦æ˜¾ç¤ºï¼Œä¾¿äºè·Ÿè¸ªæ„å»ºçŠ¶æ€

## ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚
- **å†…å­˜**: è‡³å°‘ 8GB (æ¨è 16GB æˆ–æ›´å¤š)
- **ç£ç›˜ç©ºé—´**: è‡³å°‘ 100GB å¯ç”¨ç©ºé—´
- **CPU**: å¤šæ ¸å¤„ç†å™¨ (æ„å»ºé€Ÿåº¦ä¸æ ¸å¿ƒæ•°æ­£ç›¸å…³)

### è½¯ä»¶è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04/22.04 æˆ– Debian 11/12
- **æƒé™**: Root æƒé™æ‰§è¡Œ
- **ç½‘ç»œ**: ç¨³å®šå¯é çš„äº’è”ç½‘è¿æ¥

### æ„å»ºæ—¶é—´é¢„ä¼°
- **åŸºç¡€ç³»ç»Ÿ**: 2-4 å°æ—¶
- **æ¡Œé¢ç³»ç»Ÿ**: 3-6 å°æ—¶

## å¿«é€Ÿå¼€å§‹

### 1. ä¸‹è½½è„šæœ¬

```bash
wget https://raw.githubusercontent.com/your-repo/build-vim4-armbian.sh
chmod +x build-vim4-armbian.sh
```

### 2. æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯

```bash
sudo ./build-vim4-armbian.sh --help
```

### 3. æ‰§è¡Œæ„å»º

**é€‰é¡¹1: åªé…ç½®ç¯å¢ƒ** (æ¨èé¦–æ¬¡ä½¿ç”¨)
```bash
sudo ./build-vim4-armbian.sh --config
```

**é€‰é¡¹2: æ„å»ºåŸºç¡€ç³»ç»Ÿ**
```bash
sudo ./build-vim4-armbian.sh --minimal
```

**é€‰é¡¹3: æ„å»ºæ¡Œé¢ç³»ç»Ÿ**
```bash
sudo ./build-vim4-armbian.sh --desktop
```

**é€‰é¡¹4: ä½¿ç”¨è‡ªå®šä¹‰å·¥ä½œç›®å½•**
```bash
# åœ¨SSDä¸Šæ„å»ºä»¥åŠ é€Ÿè¿‡ç¨‹
sudo ./build-vim4-armbian.sh --work-dir /mnt/ssd/armbian-build --desktop

# ç®€å†™å½¢å¼
sudo ./build-vim4-armbian.sh -w /home/user/build --minimal
```

## è¯¦ç»†ä½¿ç”¨è¯´æ˜

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | ç®€å†™ | æè¿° |
|------|------|------|
| `--help` | `-h` | æ˜¾ç¤ºå®Œæ•´çš„å¸®åŠ©ä¿¡æ¯ |
| `--config` | `-c` | åªè¿›è¡Œç¯å¢ƒé…ç½®ï¼Œä¸å¼€å§‹æ„å»º |
| `--minimal` | `-m` | é…ç½®ç¯å¢ƒå¹¶æ„å»ºåŸºç¡€ç³»ç»Ÿ |
| `--desktop` | `-d` | é…ç½®ç¯å¢ƒå¹¶æ„å»ºæ¡Œé¢ç³»ç»Ÿ |
| `--info` | `-i` | æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯å’Œæ„å»ºçŠ¶æ€ |
| `--work-dir DIR` | `-w DIR` | è®¾ç½®è‡ªå®šä¹‰å·¥ä½œç›®å½• |

### å·¥ä½œç›®å½•è¯´æ˜

é»˜è®¤å·¥ä½œç›®å½•ä¸º `/opt/armbian-build`ï¼Œä½ å¯ä»¥ä½¿ç”¨ `--work-dir` å‚æ•°æŒ‡å®šè‡ªå®šä¹‰ç›®å½•ï¼š

```bash
# å„ç§ä½¿ç”¨åœºæ™¯ç¤ºä¾‹
sudo ./build-vim4-armbian.sh --work-dir /mnt/ssd/armbian --desktop    # SSDåŠ é€Ÿ
sudo ./build-vim4-armbian.sh --work-dir /home/user/armbian-build -m   # ç”¨æˆ·ç›®å½•
sudo ./build-vim4-armbian.sh --work-dir /data/armbian -d              # æ•°æ®åˆ†åŒº
```

#### ç›®å½•ç»“æ„
```
å·¥ä½œç›®å½•/
â”œâ”€â”€ build/                    # Armbian æ„å»ºç³»ç»Ÿ
â”‚   â”œâ”€â”€ userpatches/         # ç”¨æˆ·è‡ªå®šä¹‰é…ç½®å’Œè¡¥ä¸
â”‚   â”œâ”€â”€ config/boards/       # æ¿çº§é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ output/images/       # âœ… ç”Ÿæˆçš„é•œåƒæ–‡ä»¶ä½ç½®
â”‚   â””â”€â”€ build-vim4-*.sh     # æ„å»ºè„šæœ¬
â”œâ”€â”€ first-boot-optimize.sh   # é¦–æ¬¡å¯åŠ¨ä¼˜åŒ–è„šæœ¬
â””â”€â”€ build.log               # æ„å»ºæ—¥å¿—æ–‡ä»¶
```

### æ„å»ºæµç¨‹

1. **ç¯å¢ƒæ£€æŸ¥** - éªŒè¯ç³»ç»Ÿç¯å¢ƒå’Œèµ„æº
2. **ä¾èµ–å®‰è£…** - å®‰è£…ç¼–è¯‘å·¥å…·å’Œæ„å»ºä¾èµ–
3. **æºç å‡†å¤‡** - å…‹éš†å’Œé…ç½® Armbian æ„å»ºç³»ç»Ÿ
4. **æ¿çº§é…ç½®** - åº”ç”¨ VIM4 ä¸“ç”¨é…ç½®å’Œä¼˜åŒ–
5. **ç³»ç»Ÿæ„å»º** - ç¼–è¯‘å†…æ ¸å’Œç”Ÿæˆæ ¹æ–‡ä»¶ç³»ç»Ÿ
6. **é•œåƒæ‰“åŒ…** - åˆ›å»ºå¯åˆ·å†™çš„ SDå¡/eMMC é•œåƒ
7. **ç»“æœéªŒè¯** - æ£€æŸ¥ç”Ÿæˆçš„é•œåƒæ–‡ä»¶

## è¾“å‡ºæ–‡ä»¶

### ç”Ÿæˆçš„é•œåƒæ–‡ä»¶
æ„å»ºå®Œæˆåï¼Œé•œåƒæ–‡ä»¶ä½äºï¼š
```
${WORK_DIR}/build/output/images/
```

æ–‡ä»¶å‘½åæ ¼å¼é€šå¸¸ä¸ºï¼š
- `Armbian_*_Khadas-vim4_*_bullseye_*.img`
- `Armbian_*_Khadas-vim4_*_bookworm_*.img`

### é¦–æ¬¡å¯åŠ¨è„šæœ¬
```
${WORK_DIR}/first-boot-optimize.sh
```

æ­¤è„šæœ¬åº”åœ¨ç›®æ ‡è®¾å¤‡é¦–æ¬¡å¯åŠ¨åè¿è¡Œï¼Œç”¨äºç³»ç»Ÿä¼˜åŒ–å’Œç¡¬ä»¶æ£€æµ‹ã€‚

## ç¡¬ä»¶æ”¯æŒ

### å·²å¯ç”¨çš„ç¡¬ä»¶ç‰¹æ€§
- âœ… **CPU**: Amlogic A311D2 å››æ ¸ Cortex-A73 + åŒæ ¸ Cortex-A53
- âœ… **GPU**: ARM Mali-G52 MP4
- âœ… **å†…å­˜**: 4GB/8GB LPDDR4X
- âœ… **å­˜å‚¨**: eMMC 5.1 + MicroSD å¡æ”¯æŒ
- âœ… **ç½‘ç»œ**: åƒå…†ä»¥å¤ªç½‘ + å¯é€‰ USB ç½‘å¡
- âœ… **æ— çº¿**: æ”¯æŒå¤šç§ USB æ— çº¿ç½‘å¡
- âœ… **è“ç‰™**: è“ç‰™ 5.0 æ”¯æŒ
- âœ… **è§†é¢‘**: 4K HDMI 2.1 è¾“å‡º
- âœ… **éŸ³é¢‘**: HDMI éŸ³é¢‘ + 3.5mm è€³æœºæ¥å£
- âœ… **USB**: å¤šä¸ª USB 3.0/2.0 æ¥å£

### é©±åŠ¨æ”¯æŒ
è„šæœ¬å·²é…ç½®æ”¯æŒä»¥ä¸‹ç¡¬ä»¶é©±åŠ¨ï¼š
- **USB ç½‘å¡**: ASIXã€Realtekã€CDC Ethernet ç­‰
- **æ— çº¿ç½‘å¡**: Realtekã€Atheros ç³»åˆ—
- **è“ç‰™**: å¤šç§è“ç‰™é€‚é…å™¨
- **æ˜¾ç¤º**: Amlogic DRM æ˜¾ç¤ºé©±åŠ¨
- **æ–‡ä»¶ç³»ç»Ÿ**: Ext4ã€VFATã€NTFSã€ExFAT

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. æ„å»ºå¤±è´¥ - å†…å­˜ä¸è¶³**
```bash
# æ£€æŸ¥ç³»ç»Ÿå†…å­˜
free -h

# è§£å†³æ–¹æ³•ï¼šå¢åŠ äº¤æ¢ç©ºé—´
sudo fallocate -l 8G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

**2. æ„å»ºå¤±è´¥ - ç£ç›˜ç©ºé—´ä¸è¶³**
```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# è§£å†³æ–¹æ³•ï¼šæ¸…ç†ç©ºé—´æˆ–ä½¿ç”¨æ›´å¤§åˆ†åŒº
sudo ./build-vim4-armbian.sh --work-dir /path/to/larger/partition --config
```

**3. ç½‘ç»œä¸‹è½½å¤±è´¥**
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping -c 3 mirrors.tuna.tsinghua.edu.cn

# è§£å†³æ–¹æ³•ï¼šé‡è¯•æ„å»ºæˆ–æ£€æŸ¥ä»£ç†è®¾ç½®
```

**4. ä¾èµ–å®‰è£…å¤±è´¥**
```bash
# æ›´æ–°è½¯ä»¶æºåé‡è¯•
sudo apt update
sudo apt upgrade
```

### æ—¥å¿—å’Œè°ƒè¯•

è„šæœ¬æä¾›è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œå¦‚éœ€è¦æ›´è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼š

```bash
# æŸ¥çœ‹è¯¦ç»†æ„å»ºæ—¥å¿—
tail -f ${WORK_DIR}/build/output/debug/output.log

# æ£€æŸ¥æ„å»ºé…ç½®
cat ${WORK_DIR}/build/config-default.conf
```

## é«˜çº§ç”¨æ³•

### æ‰‹åŠ¨æ„å»ºæ­¥éª¤

å¦‚æœé€‰æ‹©åªé…ç½®ç¯å¢ƒï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œæ„å»ºï¼š

```bash
# è¿›å…¥æ„å»ºç›®å½•
cd ${WORK_DIR}/build

# æ„å»ºåŸºç¡€ç³»ç»Ÿ
./build-vim4-minimal.sh

# æˆ–æ„å»ºæ¡Œé¢ç³»ç»Ÿ  
./build-vim4-desktop.sh
```

### è‡ªå®šä¹‰å†…æ ¸é…ç½®

å¦‚éœ€ä¿®æ”¹å†…æ ¸é…ç½®ï¼š

```bash
# ç¼–è¾‘å†…æ ¸é…ç½®æ–‡ä»¶
vim ${WORK_DIR}/build/userpatches/linux-khadas-vim4.config

# é‡æ–°æ„å»ºï¼ˆéœ€è¦æ¸…ç†ç¼“å­˜ï¼‰
./compile.sh kernel-clean
./build-vim4-minimal.sh
```

### æ·»åŠ è‡ªå®šä¹‰è½¯ä»¶åŒ…

ä¿®æ”¹è‡ªå®šä¹‰é•œåƒè„šæœ¬ï¼š
```bash
vim ${WORK_DIR}/build/userpatches/customize-image.sh
```

åœ¨ `customize_image()` å‡½æ•°ä¸­æ·»åŠ ï¼š
```bash
# å®‰è£…è‡ªå®šä¹‰è½¯ä»¶åŒ…
apt-get install -y your-custom-package
```

## åˆ·å†™å’Œä½¿ç”¨

### åˆ·å†™é•œåƒåˆ° SD å¡

```bash
# æŸ¥æ‰¾SDå¡è®¾å¤‡
lsblk

# åˆ·å†™é•œåƒï¼ˆè¯·æ›¿æ¢ /dev/sdX ä¸ºå®é™…è®¾å¤‡ï¼‰
sudo dd if=Armbian_*.img of=/dev/sdX bs=1M status=progress
```

### é¦–æ¬¡å¯åŠ¨æ“ä½œ

1. å°†åˆ·å†™å¥½çš„ SD å¡æ’å…¥ VIM4
2. è¿æ¥ç”µæºå¯åŠ¨è®¾å¤‡
3. ä½¿ç”¨é»˜è®¤å‡­è¯ç™»å½•ï¼š
   - ç”¨æˆ·å: `root`
   - å¯†ç : `1234`
4. æ‰§è¡Œé¦–æ¬¡å¯åŠ¨ä¼˜åŒ–ï¼š
   ```bash
   ./first-boot-optimize.sh
   ```
5. æŒ‰ç…§æç¤ºå®Œæˆç³»ç»Ÿè®¾ç½®

## æŠ€æœ¯ç»†èŠ‚

### æ„å»ºé…ç½®è¯´æ˜

- **å†…æ ¸åˆ†æ”¯**: `legacy` (å‚å•†æä¾›çš„ç¨³å®šå†…æ ¸)
- **å‘è¡Œç‰ˆæœ¬**: Debian 12 (Bookworm)
- **æ–‡ä»¶ç³»ç»Ÿ**: Ext4
- **æ¡Œé¢ç¯å¢ƒ**: XFCE (æ¡Œé¢ç‰ˆ)
- **æ¶æ„**: ARM64 (aarch64)

### ä¼˜åŒ–ç‰¹æ€§

- ç¦ç”¨ KERNEL_BTF ä»¥å‡å°‘å†…å­˜ä½¿ç”¨
- ä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒè¿›è¡Œå¹¶è¡Œç¼–è¯‘
- å›½å†…é•œåƒæºåŠ é€Ÿè½¯ä»¶ä¸‹è½½
- é¢„é…ç½®å¸¸ç”¨ç¡¬ä»¶é©±åŠ¨
- ç³»ç»ŸæœåŠ¡è‡ªåŠ¨ä¼˜åŒ–

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## æ”¯æŒä¸äº¤æµ

- ğŸ“– **æ–‡æ¡£**: æœ¬ README æ–‡ä»¶
- ğŸ› **é—®é¢˜**: [GitHub Issues](https://github.com/your-repo/issues)
- ğŸ’¬ **è®¨è®º**: [GitHub Discussions](https://github.com/your-repo/discussions)

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-01)
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ¯ æ”¯æŒ Khadas VIM4 åŸºç¡€ç³»ç»Ÿå’Œæ¡Œé¢ç³»ç»Ÿæ„å»º
- ğŸ”§ è‡ªå®šä¹‰å·¥ä½œç›®å½•åŠŸèƒ½
- ğŸ“¦ å®Œæ•´çš„ç¡¬ä»¶é©±åŠ¨æ”¯æŒ

---

**æ³¨æ„**: æ­¤è„šæœ¬ä»åœ¨ç§¯æå¼€å‘ä¸­ï¼Œå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰è¿›è¡Œå……åˆ†æµ‹è¯•ã€‚å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æäº¤ Issueã€‚
